 R←Test_19(stopFlag batchFlag);⎕TRAP
⍝ Test "errorFolder" and "".
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')
 R←∆Failed

⍝ Preconditions...
 #.⎕SHADOW'parms'
 #.parms←##.HandleError.CreateParms
 #.parms.errorFolder←(#.FilesAndDirs.GetTempPath),'HandleError_',(⍕⎕TS)~' '
 #.parms.checkErrorFolder←1
 ⎕TRAP←(405 'E' '406 ##.HandleError.Process #.parms')(0 'S')

 :Trap 406
     {⎕SIGNAL ⍵}405
     →GoToTidyUp 1
 :EndTrap

 →GoToTidyUp ⎕EN≠406
 →GoToTidyUp 0=#.FilesAndDirs.Exists #.parms.errorFolder

 {}#.FilesAndDirs.RmDir #.parms.errorFolder

 #.parms.errorFolder←('HandleError_',(⍕⎕TS)~' '),'\'
 :Trap 406
     {⎕SIGNAL ⍵}405
     →GoToTidyUp 1
 :EndTrap

 →GoToTidyUp ⎕EN≠406
 →GoToTidyUp 0=#.FilesAndDirs.Exists #.parms.errorFolder  ⍝ This fails in 2016-09-01 due to a bug in Dyalog: <01234>

 {}#.FilesAndDirs.RmDir #.parms.errorFolder

 R←∆OK

∆TidyUp:
 :Trap 0
     {}#.FilesAndDirs.RmDir #.parms.errorFolder
 :EndTrap
